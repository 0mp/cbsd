#!/bin/sh
#v10.1.2
globalconf="${workdir}/cbsd.conf"
CBSDMODULE="helpers"
MYARG="jname"
MYOPTARG=""
MYDESC="cbsd service wrapper"
ADDHELP="jname= work in with jail\n"

[ -f ${globalconf} ] || err 1 "no such conf file"
. ${globalconf}
. ${subr}
. ${strings}
. ${system}
init $*

#defines
_MYDIR=$(dirname `realpath $0`)

shift # skip for jname

[ -z "${cmd}" ] && cmd="${@}"
[ -z "${cmd}" ] && err 1 "${MAGENTA}Empty command${NORMAL}"

## MAIN ##
. ${jrcconf}
[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"
[ ${jid} -eq 0 ] && err 1 "Not running"

[ ! -d "${data}/etc" ] && err 1 "${MAGENTA}No such etc dir for jail: ${GREEN}${jname}${NORMAL}"

/usr/sbin/jexec ${jid} /usr/sbin/service ${cmd}

_err=$?

exit ${_err}
