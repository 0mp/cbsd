#!/bin/sh
#v9.2.0
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG="conf"
MYDESC="create package repo dialog-based UI"
ADDHELP="conf= alternarive config path instead of workdir/etc/cpr.conf\n"

[ -f ${globalconf} ] || err 1 "no such conf file";
. ${globalconf}
. ${subr}
. ${inventory}
. ${distccacheconf}

init $*

DIALOGTMP="${ftmp}/dialog.tmp.$$"
DIALOG=${DIALOG=/usr/bin/dialog}
[ -z "${conf}" ] && conf="$etcdir/cpr.conf"
BACKTITLE="--backtitle cbsd-cpr"

choice_arch()
{
 $DIALOG ${BACKTITLE} --title "Select architecture."  --clear \
         --default-item "amd64" --menu "Make your choice." 10 50 2 \
         "i386" "Processor arch." \
         "amd64" "Processor arch." 2> ${DIALOGTMP}

 retval2=$?
 choice2=`cat ${DIALOGTMP}`

 case $retval2 in
    0) export R_ARCH="${choice2}"
	;;
    *) return 0
	;;
 esac

 return $retval2
}

choice_release_ver()
{
 $DIALOG ${BACKTITLE} --title "Select OS releng version."  --clear \
         --default-item "9.1.0" --menu "              Make your choice." 12 50 4 \
         "9.0.0" "RELEASE." \
         "9.1.0" "RELEASE." 2> ${DIALOGTMP}

 retval312=$?
 choice312=`cat ${DIALOGTMP}`

 case $retval312 in
    0)
	export OS_VER="${choice312}"
	mkdir -p $RELEASE_DIR/data/$R_ARCH/$OS_BRANCH/$OS_VER
	;;
    255) exit 
	;;
 esac

return $retval312
}

#MAIN
. ${conf}
. ${buildconf}

[ -z "${continue}" ] && continue=0
[ -z "${repoversion}" ] && repoversion="default"
[ -z "${basename}" ] && basename="default"

$DIALOG ${BACKTITLE} --title "create package reposiory"  --clear \
        --default-item "commit" --menu "\n cbsd cpr settings" 18 55 18 \
	continue "${continue}" \
	repoversion          "${repoversion}" \
	ccachefs    "${CCACHEFS}" \
        arch        "${arch}" \
        ver         "${ver}" \
        basename    "${basename}" \
	notify	    "${CBSDRCPT}" \
        shedule     "${SCHEDULE}" \
        commit     "" 

retval1=$?

