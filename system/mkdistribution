#!/bin/sh
#v10.0.0
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG="ver arch basename stable destdir"
MYDESC="Create default FreeBSD distribution .txz files from base/kernel dir"
ADDHELP="ver=head for current.\n\
stable=1 for RELENG_X\n\
destdir= for alternative install path in root dir\n"

[ -f ${globalconf} ] || err 1 "no such conf file";
. ${globalconf}
. ${subr}
. ${inventory}
. ${color}
init $*

# By default ver=current version
. ${buildconf}

if [ -z "${basename}" ]; then
    SRC="${basejaildir}/${basejailpref}_${arch}_${ver}"
else
    SRC="${basejaildir}/${basejailpref}_${basename}_${arch}_${ver}"
fi

if [ -n "${destdir}" ]; then
    DST="${destdir}"
else
    DST="${tmpdir}"
fi

[ -d "${SRC}" ] || err 1 "${MAGENTA}No such source: ${GREEN}${SRC}${NORMAL}"
[ -d "${DST}" ] || /bin/mkdir -p ${DST}

DISTRIBUTION="base kernel"

set -x xtrace

cd ${SRC}

tar cJf ${DST}/base.txz .

[ -z "${name}" ] && name="GENERIC"

if [ -z "${basename}" ]; then
    SRC="${basejaildir}/kernel_${name}_${arch}_${ver}"
else
    SRC="${basejaildir}/kernel_${basename}_${name}_${arch}_${ver}"
fi

cd ${SRC}
tar cJf ${DST}/kernel.txz .

