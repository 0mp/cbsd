#!/usr/local/bin/cbsd
#v10.0.4
CBSDMODULE="jail"
MYARG="jname"

. ${subr}
. ${color}

[ ! -f ${sharedir}/jail-arg ] && err 1 "${GREEN}no jail-arg file${NORMAL}";
. ${sharedir}/jail-arg

MYOPTARG="$JARG mode"
MYDESC="Create ascii rc.conf for jail"
ADDHELP="mode=force for modification on the running jail\n"

. ${inventory}
. ${tools}
. ${strings}
init $*

. ${jrcconf}
[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"

cat <<EOF
# DO NOT EDIT THIS FILE. PLEASE USE INSTEAD:
# cbsd jconfig jname=${jname}
EOF

for i in ${JARG}; do
    VAL=$(cbsdsql local SELECT ${i} FROM jails WHERE jname=\"${jname}\")
    [ "${VAL}" = "(null)" -o -z "${VAL}" ] && VAL=""
    echo "${i}=\"${VAL}\";"
done


if [ "${emulator}" = "bhyve" ]; then
    . ${sharedir}/bhyve.conf
    for i in ${MYCOL}; do
	[ "${i}" = "jname" ] && continue
	VAL=$(cbsdsql local SELECT ${i} FROM bhyve WHERE jname=\"${jname}\")
	[ "${VAL}" = "(null)" -o -z "${VAL}" ] && VAL=""
	echo "${i}=\"${VAL}\";"
    done
fi

#finally set jname
echo "jname=\"${jname}\""

# exit code 0 is nessesary for dot()
exit 0
