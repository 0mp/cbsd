#!/bin/sh
# v9.1.0
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG=""
MYDESC="List jail run order"

[ -f ${globalconf} ] || err 1 "no such conf file";
. ${globalconf}
. ${subr}
. ${inventory}
init $*

[ -d "${jailrcconfdir}" ] || err 1 "No rcconf dir"

MYORDER=""
SKIP=""

for J in `/bin/ls ${jailrcconfdir}`; do
	. ${jailrcconfdir}/${J}
    	[  -z "${jname}" ] && continue

setup=0
for S in ${SKIP}; do
	[ "$jname" = "${S}" ] && setup=1
done

[ $setup -eq 1 ] && continue

if [ -n "${after}" ]; then
NEWORDER=""
for DELME in $MYORDER; do
[ "${DELME}" != "${after}" ] && NEWORDER="${NEWORDER} ${DELME}"
done
MYORDER="${NEWORDER} ${after} ${jname}"
SKIP="${SKIP} ${after} ${jname}"
else
	MYORDER="${MYORDER} ${jname}"
fi

after=""
done

for A in ${MYORDER}; do
B=`cbsd jstatus jname=${A}`
[ $? -eq 1 ] && printf "${A} "
done
printf "\n"

