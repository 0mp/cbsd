#!/bin/sh
#v9.2.2
globalconf="${workdir}/cbsd.conf";
MYARG="jname"

[ -f ${globalconf} ] || err 1 "no such conf file";

. ${globalconf}
. ${subr}
. ${color}

[ ! -f ${sharedir}/jail-arg ] && err 1 "${GREEN}no jail-arg file${NORMAL}";
. ${sharedir}/jail-arg

MYOPTARG="$JARG mode"
MYDESC="Modify parameter for jail"
ADDHELP="mode=force for modification on the running jail\n"

. ${inventory}
. ${tools}
init $*

JAILRCCONF="${jailrcconfdir}/rc.conf_${jname}"
[ ! -f  "${JAILRCCONF}" ] && err 1 "${MAGENTA}no conf rc.conf file for jail: ${GREEN}${JAILRCCONF}${NORMAL}"

if [ "${mode}" != "force" ]; then
    ##### check for already running
    ST=`cbsd jstatus jname=${jname}`
    [ $? -ne 0 ] || err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"
    [ ${ST} -ne 0 ] && err 1 "${MAGENTA}Modify jail on-the-fly currenlty not implemented${NORMAL}"
    JAILRCCONF="${jailrcconfdir}/rc.conf_${jname}"
fi

for n in $@; do

    argpart=${n%%=*}

    for i in ${JARG}; do
	if [ "${argpart}" = "${i}" -a "${argpart}" != "jname" ]; then
	    eval VAL=\$$i
	    sysrc -qf $JAILRCCONF ${i}="${VAL}" > /dev/null
	fi
    done

done

# exit code 0 is nessesary for dot()
exit 0
