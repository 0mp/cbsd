#!/usr/local/bin/cbsd
#v9.2.2
globalconf="${workdir}/cbsd.conf";
MYARG="jname"

[ -f ${globalconf} ] || err 1 "no such conf file";

. ${globalconf}
. ${subr}
. ${color}
. ${strings}

[ ! -f ${sharedir}/jail-arg ] && err 1 "${GREEN}no jail-arg file${NORMAL}";
. ${sharedir}/jail-arg

MYOPTARG="$JARG mode"
MYDESC="Modify parameter for jail"
ADDHELP="mode=force for modification on the running jail\n"

. ${inventory}
. ${tools}
init $*

. ${jrcconf}
[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"

if [ "${mode}" != "force" ]; then
    ##### check for already running
    [ ${jid} -ne 0 ] && err 1 "${MAGENTA}Modify jail on-the-fly currenlty not implemented${NORMAL}"
fi

for n in $@; do

    argpart=${n%%=*}

    for i in ${JARG}; do
	if [ "${argpart}" = "${i}" -a "${argpart}" != "jname" ]; then
	    eval VAL=\$$i
	    cbsdsql local UPDATE jails SET ${i}=\"${VAL}\" WHERE jname=\"${jname}\"
	fi
    done

done

# exit code 0 is nessesary for dot()
exit 0
