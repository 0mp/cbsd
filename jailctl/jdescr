#!/usr/local/bin/cbsd
#v9.2.2
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG="jname mode editor"
MYDESC="Show or modify jail description"
ADDHELP="mode=update for update information\n\
jname - specify jname\n\
editor=mcedit for altrnative editor\n"

[ -f ${globalconf} ] || err 1 "no such conf file";
. ${globalconf}
. ${subr}
. ${color}
. ${strings}

init $*

showdescr()
{
    SYSDIR="${jailsysdir}/${jname}"
    PDESCR="${SYSDIR}/descr"

    if [ "${mode}" = "update" ]; then
	[ ! -d "${SYSDIR}" ] && mkdir -p ${SYSDIR}
	${editor} "${PDESCR}"
    else
	[ -f "${PDESCR}" ] && cat ${PDESCR}
    fi
}

showall()
{
    local jname

    2>/dev/null cbsdsql local SELECT jname FROM jails WHERE status\<2| while read jname; do
	[ -z "${jname}" ] && continue
	${ECHO} "${BOLD}${jname} {${NORMAL}"
	    showdescr
	    ${ECHO} "${BOLD}}${NORMAL}"
    done
}

[ -z "${editor}" ] && editor="vi"

if [ -z "${jname}" ]; then
    showall
else
    . ${jrcconf}
    [ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"
    showdescr
fi
