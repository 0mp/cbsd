#!/bin/sh -
#v9.0.0
[ -n "${1}" ] || {
    echo "$0 --help"
    exit
}

go()
{
globalconf="${workdir}/cbsd.conf";

[ -f ${globalconf} ] || err 1 "no such conf file";
. ${globalconf}

case "${1}" in
"--help")
    cbsd help
    exit
    ;;
"initenv")
    env workdir=${workdir} /usr/local/cbsd/sudoexec/$@
    exit
    ;;
"sudo")
    shift
    [ -n "${1}" ] || { echo "Empty prog"; exit 1 ; }
    PROG=${1}
    D="${sudoexecdir} ${systemsudoexecdir}"
    CMDOK=0

    for _dir in $D; do
    SUPROG="${_dir}/${PROG}"
    if [ -f "${SUPROG}" ]; then
	CMDOK=1
	/usr/local/bin/sudo ${_dir}/${@}
    fi
    done
    [ $CMDOK -eq 1 ] || { echo "command not found in sudoexecdir"; exit 1; }
    ;;
*)
    . ${workdir}/securecmd
    [ -n "$SECCMD" ] || { echo "No secure cmd list"; exit 1; }
    SECOK=0
    for _i in ${SECCMD}; do
	[ "${_i}" != "${1}" ] || { SECOK=1; break; }
    done
    [ $SECOK -eq 1 ] || { echo "command $1 not allowed via cbsd"; exit 1; }

    /usr/bin/env PATH=${workdir}/bin:${workdir}/sbin:${workdir}/tools:${workdir}/jailctl:${workdir}/nodectl:${workdir}/system:$PATH $@
    return $?
    ;;
esac
}
export \
