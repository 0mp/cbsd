.Dd May 20, 2016
.Dt cbsd 8
.Os
.Sh NAME
.Nm cbsd
.Nd FreeBSD jail management tools
.Sh SYNOPSIS
.Nm cbsd
.Op cmd
.Nm cbsd
.Op cmd
.Op param=val
.Nm cbsd
.Op --help
.Sh DESCRIPTION
.Nm
is a jails and VMs management tools. It builds upon and extends standard
tools used for jails and bhyve manipulation.
.Pp
List of some of the programs and functions involved in
.Nm
:
.Bl -dash -width Ds
.It
vnet (VIMAGE)
.It
zfs
.It
racct/rctl
.It
pf/ipfw/ipfilter
.It
carp
.It
hastd
.It
bhyve
.El

Many of these subsystems are not directly related to jails, however allow
.Nm
(being the connecting link between these components) to provide the system
administrator with more advanced and integrated system for problem solving.
.Pp
The information provided below could be useful to the system administrator
and describes the
.Nm
architecture in more detail. It is also recommended to read through the
official articles about FreeBSD Jails for better understanding of the jails
basics.

.Ss Naming cnoventions
Let us agree on some names and values that will be used
throughout the documentation:

.Bl -tag -width Ds
.It node
physical server / resource unit
.It jail
isolated environment with its own set of software/services.
.It farm
cluster of interconnected nodes, a full-fledged peer network (each node can do other tasks)
.It basejail
in the CBSD content - copy of FreeBSD file base.
.It cbsd
an entity that has control over the particular node(s) and certain
subsystems of FreeBSD, is able to provide a simplified and unified action
(API) on the nodes or jails and provides ACL and setting permissions for
CBSD customers
.It $workdir
working directory on CBSD node, it is initialized through cbsd initenv
(usually /usr/jails)
.It $jname
jail name

.Nm
allows jails creation, backups, snapshoting, cloning and changing different
jails options. It also allows to control the order in which the jails should be
started. When using more than one node runnning
.Nm
it allows to clone jails between nodes and even allows to
control the remote node(s) from the "master" of the farm.
.Pp
All commands begin with
.Nm
prefix.
.Pp
The
.Nm
commands can accept arguments which are written in a "param=value" form.
.Nm
commands can have both obligatory arguments and arguments which are optional.
To receive list of all available commands type: cbsd --help
.Pp
Each subcommand has a short usage help available when typing cbsd <subcommand>
--help and an extended manual page accessible by typing "man cbsd-subcommand".
The subcommands are as follows:
.Bl -tag -width Ds
.It Cm alljails Ns = Ns Ar 1

.Sh ENVIRONMENT
By default, CBSD displays text in color (using escape sequences ANSII).
If for some reason the color is unpleasant, or you want to use output from
CBSD utilities in your scripts, you can disable the color through the
environment variable NOCOLOR=1. For example:

.Dl % env NOCOLOR=1 cbsd jls

.Sh FILES
.Bl -tag -width Ds -compact
.It ${workdir}/.rssh/
Directory to store private keys of remote nodes. The files are added and
removed via the 
.Nm Cm node
.It ${workdir}/.ssh
Here is kept private and a public key of the node itself. Formed during the initialization with the command cbsd initenv. It is from here will take the public key of remote hosts on the cbsd node mode=add command. Key file name is the md5 sum of the nodename.
${workdir}/basejail	Here are kept ready for use at the bases and kernels FreeBSD (the result of cbsd buildworld/buildkernel, cbsd installworld/installkernel or cbsd repo action=get sources=base/kernel)
${workdir}/etc	Configuration files needed to run CBSD
${workdir}/export	Default directory, which will be stored in a file exported by the jail (when the cbsd jexport jname=$jname, this directory will file $jname.img)
${workdir}/import	Default directory of which will be imported to jail (at cbsd jimport jname=$jname, will be deployed jail $jname)
${workdir}/jails	This directory contains the mount point for the root jails, who use baserw=0.
${workdir}/jails-data	This catalog have the jails data. It is these places need to backup jails (including fstab and rc.conf files). Also, if the jail use baserw=1, these directories are the root of the jail when it starts
${workdir}/jails-fstab	fstab file for the jails. The syntax for regular FreeBSD with the only exception that the path to the mount point is written relative to the root jail (record /usr/ports /usr/ports nullfs rw 0 0 in the file fstab.$jname means that of the master node directory /usr/ports will be mounted at startup in ${workdir}/jails/$jname/usr/ports)
${workdir}/jails-rcconf	rc.conf files for jail creation. These parameters can be changed at your editor, or via the command cbsd jset $jname param=val (eg cbsd jset jname=$jname ip="192.168.0.2/24"). To change these settings jail should be turned off.
${workdir}/jails-system	This catalog may contain some helper scripts related to the jail (eg wizards to configure, configurators, etc) as well as the preserved jail traffic when using ipfw and its description. This catalog participates in jimport/jexport operations and migration of jail
${workdir}/var	directory that contains system information CBSD. For example, in ${workdir}/var/db is an inventory of local and remote nodes if were added
/usr/local/cbsd	A copy of the original files installed by CBSD port. Also contains the working scripts in sudoexec

.Sh EXIT STATUS
.Ex -std
The codes are usually described in the --help section for the command/subcommand.

.Sh EXAMPLES
.Tp
Show list of jails:
.Pp
.Nm Cm jls
.Pp
.Tp
Show help for jlogin command:
.Pp
.Nm Cm jlogin --help
.Pp
.Tp
Run DIALOG-based jail configuration tools:
.Pp
.Nm Cm jconstruct-tui
.Pp
.Sh EXIT STATUS
cbsd returns a zero exist status if it succeeds. Non zero is returned in case
of a failure or non-standard conclusion, the codes are usually described in
the --help parameter to a command/subcommand.
.Sh SEE ALSO
.Xr jail 8
.Pp
WWW: http://www.bsdstore.ru
