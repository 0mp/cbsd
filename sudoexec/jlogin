#!/bin/sh
#v9.2.2
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG="jname remote inter"
MYDESC="Exec login into jail"

# Login by jid not supported yet

[ -f "${globalconf}" ] || err 1 "no such conf file";
. ${globalconf}
. ${subr}
. ${strings}
init $*

[ -n "$jname" ] || jname=$1
[ -z "${remote}" ] && remote=0

try_remote()
{
    [ -f "${jailmapdb}" -a "${remote}" != "1" ] || err 1 "No such rc.conf for jail found"
    . ${jailmapdb} 2>/dev/null
    eval VAL=\$$jname
    [ -n "${VAL}" ] && { 
    RHST=`echo $VAL|awk '{printf $1"\n"}'`
    getyesno "Found jail on remote node: ${RHST}. Try to login?"
    [ $? -eq 1 -o $? -eq 3 ] && err 1 "No such jail for login"
    cbsd rexe node=${RHST} cbsd jlogin jname=$jname remote=1
    err 0 ""
    }
}

. ${jrcconf}
[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"
[ "$baserw" = "1" ] && path=$data

[ $jid -eq 0 ] && err 1 "Not running"

[ -z "${nice}" ] && nice="0"
/usr/bin/nice -n ${nice} /usr/sbin/jexec ${jid} login -f root
